<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Usage | Feathers</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    
        <link rel="stylesheet" href="../styles/website.css">
    

        
    
    
    <link rel="next" href="../hooks/examples.html" />
    
    
    <link rel="prev" href="../hooks/readme.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="7.1"
        data-chapter-title="Usage"
        data-filepath="hooks/usage.md"
        data-basepath=".."
        data-revision="Mon Feb 15 2016 22:58:02 GMT+0100 (CET)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="getting-started/readme.html">
            
                
                    <a href="../getting-started/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Getting Started
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="getting-started/quick-start.html">
            
                
                    <a href="../getting-started/quick-start.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Quick Start
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="getting-started/your-first-app/readme.html">
            
                
                    <a href="../getting-started/your-first-app/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Your First App
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="why/readme.html">
            
                
                    <a href="../why/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Why Feathers
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="why/philosophy.html">
            
                
                    <a href="../why/philosophy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Philosophy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="why/vs/readme.html">
            
                
                    <a href="../why/vs/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Features
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="why/vs/express-socketio.html">
            
                
                    <a href="../why/vs/express-socketio.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Feathers vs Express + Socket.io
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="why/vs/meteor.html">
            
                
                    <a href="../why/vs/meteor.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Feathers vs Meteor
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="why/vs/sails.html">
            
                
                    <a href="../why/vs/sails.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        Feathers vs Sails
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="why/vs/firebase.html">
            
                
                    <a href="../why/vs/firebase.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        Feathers vs Firebase
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="why/vs/parse.html">
            
                
                    <a href="../why/vs/parse.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                        Feathers vs Parse
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="services/readme.html">
            
                
                    <a href="../services/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Services
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="rest/readme.html">
            
                
                    <a href="../rest/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        REST
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="real-time/readme.html">
            
                
                    <a href="../real-time/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Real-Time
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="real-time/events.html">
            
                
                    <a href="../real-time/events.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        Service events
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="real-time/socket-io.html">
            
                
                    <a href="../real-time/socket-io.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        Socket.io
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="real-time/primus.html">
            
                
                    <a href="../real-time/primus.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        Primus
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="real-time/filtering.html">
            
                
                    <a href="../real-time/filtering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Event Filtering
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="databases/readme.html">
            
                
                    <a href="../databases/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Databases
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="databases/pagination.html">
            
                
                    <a href="../databases/pagination.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Pagination and sorting
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="databases/querying.html">
            
                
                    <a href="../databases/querying.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Querying
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="databases/extending.html">
            
                
                    <a href="../databases/extending.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        Extending adapters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="databases/memory.html">
            
                
                    <a href="../databases/memory.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        In Memory
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="databases/nedb.html">
            
                
                    <a href="../databases/nedb.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        NeDB
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="databases/mongoose.html">
            
                
                    <a href="../databases/mongoose.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.6.</b>
                        
                        Mongoose
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.7" data-path="databases/sequelize.html">
            
                
                    <a href="../databases/sequelize.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.7.</b>
                        
                        Sequelize
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.8" data-path="databases/knexjs.html">
            
                
                    <a href="../databases/knexjs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.8.</b>
                        
                        KnexJS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.9" data-path="databases/waterline.html">
            
                
                    <a href="../databases/waterline.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.9.</b>
                        
                        Waterline
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="hooks/readme.html">
            
                
                    <a href="../hooks/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Hooks
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="7.1" data-path="hooks/usage.html">
            
                
                    <a href="../hooks/usage.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Usage
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="hooks/examples.html">
            
                
                    <a href="../hooks/examples.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Examples
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="hooks/bundled.html">
            
                
                    <a href="../hooks/bundled.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        Built-in hooks
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="clients/readme.html">
            
                
                    <a href="../clients/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Client Use
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="clients/feathers.html">
            
                
                    <a href="../clients/feathers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Universal Feathers
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="clients/rest.html">
            
                
                    <a href="../clients/rest.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        REST
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="clients/socket-io.html">
            
                
                    <a href="../clients/socket-io.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        Socket.io
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="clients/primus.html">
            
                
                    <a href="../clients/primus.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        Primus
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="middleware/readme.html">
            
                
                    <a href="../middleware/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Middleware
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="middleware/express.html">
            
                
                    <a href="../middleware/express.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Express Middleware
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="middleware/routing.html">
            
                
                    <a href="../middleware/routing.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Routing and Versioning
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="authentication/readme.html">
            
                
                    <a href="../authentication/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Authentication
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1" data-path="authentication/local.html">
            
                
                    <a href="../authentication/local.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.1.</b>
                        
                        Local (username &amp; password)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="authentication/token.html">
            
                
                    <a href="../authentication/token.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.2.</b>
                        
                        Token (JWT)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.3" data-path="authentication/oauth1.html">
            
                
                    <a href="../authentication/oauth1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.3.</b>
                        
                        Oauth1 (Twitter, etc)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.4" data-path="authenication/oauth2.html">
            
            <span><b>10.4.</b> OAuth2 (Facebook, etc)</span>
            
            
        </li>
    
        <li class="chapter " data-level="10.5" data-path="authentication/two-factor.html">
            
                
                    <a href="../authentication/two-factor.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.5.</b>
                        
                        Two Factor
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.6" data-path="authentication/authorization.html">
            
                
                    <a href="../authentication/authorization.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.6.</b>
                        
                        Authorization / Access Control
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.7" data-path="authentication/bundled-hooks.html">
            
                
                    <a href="../authentication/bundled-hooks.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.7.</b>
                        
                        Bundled Auth Hooks
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="11" data-path="hooks/authorization.html">
            
            <span><b>11.</b> Authorization</span>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="middleware/error-handling.html">
            
                
                    <a href="../middleware/error-handling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Error Handling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="middleware/logging.html">
            
                
                    <a href="../middleware/logging.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        Logging
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="api/readme.html">
            
                
                    <a href="../api/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        Core API
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="guides/readme.html">
            
                
                    <a href="../guides/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        Guides
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="15.1" data-path="guides/migrating.html">
            
                
                    <a href="../guides/migrating.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.1.</b>
                        
                        Migrating to Feathers 2
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15.2" >
            
            <span><b>15.2.</b> Creating a plugin</span>
            
            
        </li>
    
        <li class="chapter " data-level="15.3" >
            
            <span><b>15.3.</b> React</span>
            
            
        </li>
    
        <li class="chapter " data-level="15.4" >
            
            <span><b>15.4.</b> React Native</span>
            
            
        </li>
    
        <li class="chapter " data-level="15.5" >
            
            <span><b>15.5.</b> jQuery</span>
            
            
        </li>
    
        <li class="chapter " data-level="15.6" >
            
            <span><b>15.6.</b> CanJS</span>
            
            
        </li>
    
        <li class="chapter " data-level="15.7" >
            
            <span><b>15.7.</b> Angular</span>
            
            
        </li>
    
        <li class="chapter " data-level="15.8" >
            
            <span><b>15.8.</b> VueJS</span>
            
            
        </li>
    
        <li class="chapter " data-level="15.9" >
            
            <span><b>15.9.</b> iOS</span>
            
            
        </li>
    
        <li class="chapter " data-level="15.10" >
            
            <span><b>15.10.</b> Android</span>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="16" data-path="help/readme.html">
            
                
                    <a href="../help/readme.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        Help
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="16.1" data-path="help/faq.html">
            
                
                    <a href="../help/faq.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.1.</b>
                        
                        FAQ
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16.2" data-path="contributing.html">
            
                
                    <a href="../contributing.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.2.</b>
                        
                        Contributing
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16.3" data-path="changelog.html">
            
                
                    <a href="../changelog.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.3.</b>
                        
                        Changelog
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="17" data-path="license.html">
            
                
                    <a href="../license.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        License
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Feathers</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="using-hooks">Using hooks</h1>
<p>You can add as many <code>before</code> and <code>after</code> hooks to any Feathers service method (<code>find</code>, <code>create</code>, <code>update</code>, <code>patch</code> and <code>remove</code>) or <code>all</code> service methods. Hooks will be executed in the order they have been registered. There are two ways to use hooks. Either after registering the service by calling <code>service.before(beforeHooks)</code> or <code>service.after(afterHooks)</code> or by adding a <code>before</code> or <code>after</code> object with your hooks to the service. <code>this</code> in a hook function is the service it currently runs on.</p>
<p>Lets assume a Feathers application initialized like this:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> feathers = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers&apos;</span>);
<span class="hljs-keyword">const</span> memory = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-memory&apos;</span>);
<span class="hljs-keyword">const</span> hooks = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks&apos;</span>);

<span class="hljs-keyword">const</span> app = feathers()
  .configure(feathers.rest())
  .configure(hooks())
  .use(<span class="hljs-string">&apos;/todos&apos;</span>, memory());

app.listen(<span class="hljs-number">8000</span>);

<span class="hljs-comment">// Get the wrapped service object which will be used in the other examples</span>
<span class="hljs-keyword">const</span> todoService = app.service(<span class="hljs-string">&apos;todos&apos;</span>);
</code></pre>
<h2 id="before-hooks">Before hooks</h2>
<p><code>service.before(beforeHooks)</code> hooks allow you to pre-process service call parameters. They will be called with the hook object and a callback which should be called with any errors or no arguments or <code>null</code> and the modified hook object. The hook object contains information about the intercepted method and for <code>before</code> hooks can have the following properties:</p>
<ul>
<li><strong>method</strong> - The method name</li>
<li><strong>type</strong> - The hook type (<code>before</code> or <code>after</code>)</li>
<li><strong>callback</strong> - The original callback (can be replaced but shouldn&apos;t be called in your hook)</li>
<li><strong>params</strong> - The service method parameters</li>
<li><strong>data</strong> - The request data (for <code>create</code>, <code>update</code> and <code>patch</code>)</li>
<li><strong>app</strong> - The <code>app</code> object</li>
<li><strong>id</strong> - The id (for <code>get</code>, <code>remove</code>, <code>update</code> and <code>patch</code>)</li>
</ul>
<p>All properties of the hook object can be modified and the modified data will be used for the actual service method call. This is very helpful for pre-processing parameters and massaging data when creating or updating.</p>
<p><code>before</code> hooks can set <code>hook.result</code> which will skip the original service method. This can be used to override methods (see the <a href="examples.html">soft-delete example</a>.</p>
<p>The following example adds an authorization check (if a user has been provided in the params) to <em>all</em> service methods and also adds a <code>createdAt</code> property to a newly created todo:</p>
<pre><code class="lang-js">todoService.before({
  all(hook) {
    <span class="hljs-keyword">if</span>(!hook.params.user) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;You need to be logged in&apos;</span>);
    }
  },

  create(hook, next) {
    hook.data.createdAt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
  }
});
</code></pre>
<blockquote>
<p><strong>Note:</strong> <code>all</code> hooks will be registered before specific hooks in that object. For the above example that means that the <code>all</code> hook will be added to the <code>create</code> service method and then the specific hook.</p>
</blockquote>
<h2 id="after-hooks">After hooks</h2>
<p><code>service.after(afterHooks)</code> hooks will be called with a similar hook object than <code>before</code> hooks but additionally contain a <code>result</code> property with the service call results:</p>
<ul>
<li><strong>method</strong> - The method name</li>
<li><strong>type</strong> - The hook type (<code>before</code> or <code>after</code>)</li>
<li><strong>result</strong> - The service call result data</li>
<li><strong>callback</strong> - The original callback (can be replaced but shouldn&apos;t be called in your hook)</li>
<li><strong>params</strong> - The service method parameters</li>
<li><strong>data</strong> - The request data (for <code>create</code>, <code>update</code> and <code>patch</code>)</li>
<li><strong>app</strong> - The <code>app</code> object</li>
<li><strong>id</strong> - The id (for <code>get</code>, <code>remove</code>, <code>update</code> and <code>patch</code>)</li>
</ul>
<p>In any <code>after</code> hook, only modifications to the <code>result</code> object will have any effect. This is a good place to filter or post-process the data retrieved by a service.</p>
<p>The following example filters the data returned by a <code>find</code> service call based on a users company id and checks if the current user is allowed to retrieve the data returned by <code>get</code> (that is, they have the same company id):</p>
<pre><code class="lang-js">todoService.after({
  find(hook) {
    <span class="hljs-comment">// Manually filter the find results</span>
    hook.result = hook.result.filter(current =&gt; 
      current.companyId === params.user.companyId
    );
  },

  get(hook) {
    <span class="hljs-keyword">if</span> (hook.result.companyId !== hook.params.user.companyId) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;You are not authorized to access this information&apos;</span>);
    }
  }
});
</code></pre>
<p>After hooks also support the <code>all</code> property to register a hook for every service method.</p>
<blockquote>
<p><strong>Note:</strong> <code>all</code> hooks will be registered after specific hooks in that object.</p>
</blockquote>
<h2 id="as-service-properties">As service properties</h2>
<p>You can also add <code>before</code> and <code>after</code> hooks to your initial service object right away by setting the <code>before</code> and <code>after</code> properties to the hook object. The following example has the same effect as the previous examples:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> TodoService = {
  todos: [],

  get(id, params) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.todos.length; i++) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.todos[i].id === id) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-keyword">this</span>.todos[i]);
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;Todo not found&apos;</span>));
  },

  <span class="hljs-comment">// Return all todos from this service</span>
  find(params, callback) {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-keyword">this</span>.todos);
  },

  <span class="hljs-comment">// Create a new Todo with the given data</span>
  create(data, params, callback) {
    data.id = <span class="hljs-keyword">this</span>.todos.length;
    <span class="hljs-keyword">this</span>.todos.push(data);

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(data);
  },

  before: {
    find(hook) {
      <span class="hljs-keyword">if</span> (!hook.params.user) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;You are not logged in&apos;</span>);
      }
    },

    create(hook) {
      hook.data.createdAt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
    }
  },

  after: {
    find(hook) {
      <span class="hljs-comment">// Manually filter the find results</span>
      hook.result = hook.result.filter(current =&gt;
        current.companyId === params.user.companyId
      );
    },

    get(hook) {
      <span class="hljs-keyword">if</span> (hook.result.companyId !== hook.params.user.companyId) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;You are not authorized to access this information&apos;</span>);
      }
    }
  }
}
</code></pre>
<h2 id="asynchronous-hooks">Asynchronous hooks</h2>
<p>Hooks also allow asynchronous processing either by returning a Promise or by calling a callback.</p>
<h3 id="promises">Promises</h3>
<p>All hooks can return a <a href="http://promises-aplus.github.io/promises-spec/" target="_blank">Promise</a> object for asynchronous operations:</p>
<pre><code class="lang-js">todoService.before({
  find(hook) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {

    });
  }
});
</code></pre>
<p>If you want to change the hook object just chain the returned promise using <code>.then</code>:</p>
<pre><code class="lang-js">todoService.before({
  find(hook) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.find().then(data =&gt; {
      hook.params.message = <span class="hljs-string">&apos;Ran through promise hook&apos;</span>;
      hook.data.result = result;
      <span class="hljs-comment">// Always return the hook object</span>
      <span class="hljs-keyword">return</span> hook;
    });
  }
});
</code></pre>
<p>If a promise fails, the error will be propagated immediately.</p>
<h3 id="continuation-passing">Continuation passing</h3>
<p>Another way is to pass <code>next</code> callback as the second parameter that has to be called with <code>(error, data)</code>.</p>
<pre><code class="lang-js">todoService.before({
  find(hook, next) {
    <span class="hljs-keyword">this</span>.find().then(data =&gt; {
      hook.params.message = <span class="hljs-string">&apos;Ran through promise hook&apos;</span>;
      hook.data.result = result;
      <span class="hljs-comment">// With no error</span>
      callback();
      <span class="hljs-comment">// or to change the hook object</span>
      callback(<span class="hljs-literal">null</span>, hook);
    });
  }
});
</code></pre>
<h2 id="chaining--registering-multiple-hooks">Chaining / Registering Multiple Hooks</h2>
<p>If you want to register more than one <code>before</code> or <code>after</code> hook for the same method, there are 2 ways to do this.</p>
<h3 id="dynamic-registrations">Dynamic Registrations</h3>
<p>If you register a <code>before</code> or <code>after</code> hook for a certain method in one place and then register another <code>before</code> or <code>after</code> hook for the same method, <code>feathers-hooks</code> will automatically execute them in a chained fashion <strong>in the order that they were registered</strong>.</p>
<blockquote>
<p><strong>Pro Tip:</strong> <em>This works well if you have more dynamic or conditional hooks.</em></p>
</blockquote>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> app = feathers().use(<span class="hljs-string">&apos;/users&apos;</span>, userService);

<span class="hljs-comment">// We need to retrieve the wrapped service object from app which has the added hook functionality</span>
<span class="hljs-keyword">const</span> userService = app.service(<span class="hljs-string">&apos;users&apos;</span>);

userService.before({
    ...
});

<span class="hljs-comment">// Somewhere else</span>
userService.before({
    ...
});
</code></pre>
<h3 id="defining-arrays">Defining Arrays</h3>
<p>You can also register multiple hooks at the same time, in the order that you want them executed, when you are registering your service.</p>
<blockquote>
<p><strong>Pro Tip:</strong> <em>This is the preferred method because it is bit cleaner and execution order is more apparent.</em></p>
</blockquote>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> hooks = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;your-hooks&apos;</span>);
<span class="hljs-keyword">const</span> app = feathers().use(<span class="hljs-string">&apos;/users&apos;</span>, userService);

<span class="hljs-comment">// We need to retrieve the wrapped service object from app which has the added hook functionality</span>
<span class="hljs-keyword">const</span> userService = app.service(<span class="hljs-string">&apos;users&apos;</span>);

userService.before({
  <span class="hljs-comment">// Auth is required.  No exceptions</span>
  create : [hooks.requireAuth, hooks.setUserID, hooks.setCreatedAt]
});
</code></pre>
<h2 id="communicating-with-other-services">Communicating with other services.</h2>
<p>Hooks make it convenient to work with other services. You can use the <code>hook.app</code> object to lookup the services you need to use like this:</p>
<pre><code class="lang-js"><span class="hljs-comment">/**
 * Check if provided account already exists.
 */</span>
<span class="hljs-keyword">const</span> myHook = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">hook</span>) </span>{
  <span class="hljs-comment">// Get a reference to the accounts service.</span>
  <span class="hljs-keyword">const</span> accounts = hook.app.service(<span class="hljs-string">&apos;accounts&apos;</span>);

  <span class="hljs-comment">// do something</span>
}
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../hooks/readme.html" class="navigation navigation-prev " aria-label="Previous page: Hooks"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../hooks/examples.html" class="navigation navigation-next " aria-label="Next page: Examples"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-collapsible-menu/plugin.js"></script>
    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-heading-anchors/anchor-style.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-edit-link/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"edit-link":{"base":"https://github.com/feathersjs/feathers-docs/edit/master","label":"Edit This Page"},"collapsible-menu":{},"heading-anchors":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
